<!DOCTYPE html>

<html>
    <meta charset="utf-8"> 
<head>
    <title>Test</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="./js/underscore.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/gridstack.css"/>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.0/jquery-ui.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.5.0/lodash.min.js"></script>
    <script src="./js/gridstack.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <style type="text/css">
        
        .tooltip {
  position: absolute;
  width: auto;
  height: auto;
  pointer-events: none;
font-size:15px;
font-weight: bold;
font-family: fantasy;
  background-color: rgba(255,235,153, 0.8);
  
}

    </style>
</head>

<body>
   <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="0"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="1"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="2"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="3"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="4"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="5"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="6"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="7"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="8"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="9"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="10"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="11"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="12"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="13"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="14"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="15"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    <div class="grid-stack-item"
        data-gs-x="0" data-gs-y="16"
        data-gs-width="12" data-gs-height="1">
            <div class="grid-stack-item-content"></div>
    </div>
    
    
    

    
    
 
</div>

<script>

$( document ).ready(function() {
        setTimeout(makeGraph,4000);

});


String.prototype.capFirstLetter = function() {
    return this.charAt(0).toUpperCase() + this.slice(1);
}

function makeGraph() {

    toKWH();
    
    var options = {
        cellHeight: 40,
        verticalMargin: 11,
        resizable: {autoHide:true, handles:'se'}
        
        
    };
   
   $('.grid-stack').gridstack(options);
    var grid = $('.grid-stack').data('gridstack');
   
   
   
   
   /*
     //This is key.  In order to be movable svgs must go into this div, which is created by the gridstack js so we have
    //to find it like this.  For linegrpah you will want to use select instead of select all. in outer loop and
    //do var x=document.getElementsByClassName("grid-stack-item-content ui-draggable-handle"); d3.select(x[n]);  
    var svgContainer = d3.selectAll(document.getElementsByClassName("grid-stack-item-content ui-draggable-handle")).append("svg")
                         .attr("width", 2000)//Going to have to play with this val
                         .attr("height", 3000);//Going to have to play with this val
   
   
   
   */
   
   
   
   //var svgContainer = d3.select("body").append("svg")
     //                    .attr("width", 2000)
       //                  .attr("height", 3000);
                         
   // var svgContainer = d3.select(document.getElementsByClassName("grid-stack-item-content ui-draggable-handle")).append("svg")
                   //      .attr("width", 2000)
                     //    .attr("height", 3000);


    var transform=50;


    var colors=["#ff5500", "#B27FB2", "#C8A780", "#FFC0CB", "#106271", "#ff66cc", "#99cc00", "#fff68f", "#7ecdd2", "#ffa500",
    "#800000", "#008000", "#ff7f50", "#ff4444", "#a0db8e", "#cc6633", "#999966", "#9999ff"];


    var allDorms= ["beard", "emerson-dorm", "chapin", "clark", "mcintire", "young", "meadows-west", "meadows-north", "metcalf", "kilham", "larcom", "stanton", "cragin", "everett", "meadows-east"];

    var height=40;
    var length=200;

    //var tooltip = d3.select(document.getElementsByClassName("grid-stack-item-content ui-draggable-handle")).append("div")
      var tooltip=d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);


    
    for (n=0; n<allDorms.length; n++){
        
         var x=document.getElementsByClassName("grid-stack-item-content ui-draggable-handle");
        //console.log(x[n]);
        var svgContainer = d3.select(x[n]).append("svg")
                                    .attr("width", 800)
                                    .attr("height", 75)
                                    .attr("class", "containers");
    

        
        var data = allVals[allDorms[n]]; //dormData[n]
        var max = d3.max(d3.values(data)); //find the max data point NOTE needs to be changed to be an array with all data
        var scale= height/max; //sets scale so that the max is the full bar
        var width=600/data.length; //width of each new rect is scaled to number of data points
        
        var y = document.getElementsByClassName("containers");
        
        var bar = d3.select(y[n])
                    .append("g")
                    
        

        bar.append("rect")
           .attr("width", length)
           .attr("height", height)
           .attr("fill", "#6495ED")
           .attr("stroke","black")

        //Dorm name must be added seperately, because d3   
        bar.append("text")
           .attr("dy", height/2)
           .attr("dx", length/2)
           .attr("fill", "black")
           .attr("text-anchor", "middle")
           .attr("font-weight", "bold")
           .text(allDorms[n].capFirstLetter());

        //Draws the full bar

        bar.append("rect")
           .attr("x",length)
           .attr("y",0)
           .attr("width",603)
           .attr("height", height)
           .attr("fill", "#E0FFFF")
           .attr("stroke", "black")

        for (j = 0; j < data.length; j++) { 
            var value=data[j];
            bar.append("rect")
               .attr("x",j*width+length+.5)
               .attr("height", data[j]*scale-2)
               .attr("y",(height-(data[j]*scale))/2+1)
               .attr("width",width+2)
               .attr("fill", colors[n])
               .attr("id", data[j])
               .on("mouseover", function() {
                    tooltip.transition()
                           .duration(200)
                           .style("opacity", 1);
                    tooltip.html("Average power consumed at this moment: " + (this.id*1).toFixed(2)+ " kW/h" + "<br/>" +
                    "Cost of power at this time " + (this.id*.14).toFixed(2) +" dollars" + "<br/>" +
                    "C0" + "<sub> 2 </sub>" + " generated by this power " + (this.id*.6379).toFixed(2) + "pounds")

                           .style("left", (d3.event.pageX + 5) + "px")
                           .style("top", (d3.event.pageY - 28) + "px");
                })
               .on("mouseout", function(d) {
                   tooltip.transition()
                          .duration(200)
                          .style("opacity", 0);
                });

            // console.log(data[j]);
        }  
    } 
}

function echoData(){

    console.log(allVals);

}


</script>


</body>

</html>